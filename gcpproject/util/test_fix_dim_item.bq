
. ${HOME}/lib/set_env.sh
. ${HOME}/lib/common.sh

bq query --max_rows 1 --allow_large_results --destination_table work.dim_item_fix --use_legacy_sql=false <<!
SELECT di.item_key
, di.sku_id
, di.vendor_key
, di.item_des
, di.item_short_des
, di.style_id
, di.style_des
, di.different_color_cd
, di.different_color_des
, di.different_size_cd
, di.different_size_des
, di.department_id
, di.department_nam
, di.class_id
, di.class_nam
, di.subclass_id
, di.subclass_nam
, di.division_id
, di.division_nam
, di.group_num
, di.group_nam
, di.item_status_cd
, di.standard_uom_des
, CAST(di.regular_unit_retail_amt AS NUMERIC) AS regular_unit_retail_amt
, CAST(di.selling_unit_retail_amt AS NUMERIC) AS selling_unit_retail_amt
, di.inventory_ind
, di.merchandise_ind
, di.orderable_ind
, di.sellable_ind
, di.ship_alone_ind
, di.item_create_tms
, di.last_update_tms
, CAST(di.unit_cost_amt AS NUMERIC) AS unit_cost_amt
, di.origin_country_cd
, di.item_record_status_cd
, di.season_id
, di.season_des
, di.edl_create_tms
, di.edl_create_job_nam
, di.edl_last_update_tms
, di.edl_last_update_job_nam
, di.brand_cd
FROM work.dim_item di
!
rc_check $? "Create fix table"

#COPY DATA FROM ACTUAL TABLE
bq cp --force work.dim_item edl_archive.dim_item
rc_check $? "Archive copy"
bq cp --force work.dim_item_fix work.dim_item
rc_check $? "Copy new table "
bq rm --force work.dim_item_fix
rc_check $? "Remove new1 table "
