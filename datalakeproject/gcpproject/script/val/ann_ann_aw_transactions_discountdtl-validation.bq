#!/usr/bin/bash
. ${HOME}/lib/set_env.sh
. ${HOME}/lib/common.sh

#Unique Key CHECK

sql='
select count(*) cnt 
from
    (
    select 
        d.if_entry_no
        , d.line_id
        , d.applied_by_line_id
        ,count(*) cnt
    from edl_stage.pre_aw_transaction_discount_detail d 
    group by 1,2,3 
    having count(*) >1
    )
'

run_validation "$sql" "Unique Key Check"

#completeness CHECK 

sql='
select 
    count(*) cnt
from edl_landing.ann_ann_aw_transactions_discountdtl l
left join edl_stage.pre_aw_transaction_discount_detail s
    on l.if_entry_no = s.if_entry_no
    and l.line_id = s.line_id 
    and l.applied_by_line_id  = s.applied_by_line_id 
where l.if_entry_no is null
'

run_validation "$sql" "Completeness Check"


exit ${ERROR_CD:-0}